<!DOCTYPE html>
<html>
<head>
  <title>ComSci Attendance System</title>
  <script src="static/js/common.js"></script>
  <script src="static/js/dashboard.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="static/css/dashboard.css">
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <nav class="sidebar">
      <div class="logo">
        <img src="static/images/perps.png" alt="Logo" />
        <h3>ComSci Attendance System</h3>
      </div>
      <ul class="nav-menu">
        <li class="nav-item">
          <a href="/dashboard" class="nav-link active">Dashboard</a>
        </li>
        <li class="nav-item">
          <a href="/students" class="nav-link">Students</a>
        </li>
        <li class="nav-item">
          <a href="/sessions" class="nav-link">Sessions</a>
        </li>
        <li class="nav-item">
          <a href="/analytics" class="nav-link">Analytics</a>
        </li>
        <li class="nav-item">
          <a href="/reports" class="nav-link">Reports</a>
        </li>
        <li class="nav-item">
          <a href="/class_upload" class="nav-link">Classes</a>
        </li>
      </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header -->
      <header class="header">
        <h1>Attendance Dashboard</h1>
        <div class="header-actions">
          <button>üîî</button>
          <button>‚öôÔ∏è</button>
          <button>‚ùå</button>
        </div>
      </header>

      <!-- Content -->
      <div class="content">
        <!-- Main Grid Layout -->
        <div class="main-grid">
          <!-- Left Column: Statistics Grid + Security Settings -->
          <div class="left-column">
            <!-- Statistics Grid -->
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-number" id="total-attendances">0</div>
                <div class="stat-label">Total Check-ins</div>
              </div>
              <div class="stat-card">
                <div class="stat-number" id="total-denied">0</div>
                <div class="stat-label">Failed Attempts</div>
              </div>
              <div class="stat-card">
                <div class="stat-number" id="unique-devices">0</div>
                <div class="stat-label">Unique Devices</div>
              </div>
              <div class="stat-card">
                <div class="stat-number" id="recent-activity">0</div>
                <div class="stat-label">Last Hour</div>
              </div>
            </div>

            <!-- Security Settings -->
            <div class="security-section">
              <h3>Security Settings</h3>
              <div class="form-group">
                <label for="auto-regenerate-qr">
                  <input type="checkbox" id="auto-regenerate-qr" checked> 
                  Auto-regenerate QR Code
                </label>
              </div>
              <div class="form-group">
                <label>Max Uses per Device:</label>
                <input id="max-uses" type="number" min="1" max="10" value="1">
              </div>
              <div class="form-group">
                <label>Time Window (Hours):</label>
                <input id="time-window" type="number" min="1" max="168" value="24">
              </div>
              <div class="checkbox-group">
                <input id="enable-blocking" type="checkbox" checked>
                <label for="enable-blocking">Enable Device Blocking</label>
              </div>
              <button id="save-settings" class="btn btn-primary" style="width: 100%; border-radius: 20px;">Save Settings</button>
            </div>
          </div>

          <!-- Right Column: Session Control, Instructions, QR Code, Manual Student Input -->
          <div class="right-column">
            <!-- Top Row: Session Control + Instructions -->
            <div class="dashboard-top-row" style="display: flex; justify-content: center; align-items: center; width: 100%; min-height: 320px; max-width: 700px; margin: 0 auto; gap: 48px;">
              <!-- Session Control -->
              <div class="session-control">
                <div id="session-status" class="session-status">No active session</div>
                <button id="create-session-btn" class="btn btn-primary" style="width: 100%;">Create Attendance Session</button>
                <button id="stop-session-btn" class="btn btn-danger hidden" style="width: 100%;">Stop Session</button>
              </div>
              <!-- Instructions Box -->
              <div class="instructions-box" style="background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 8px; padding: 18px 20px; min-width: 240px; max-width: 320px; font-size: 15px; color: #333; box-sizing: border-box; text-align: left;">
                <h4 style="margin-top: 0; margin-bottom: 10px; color: #007bff; font-size: 17px; text-align: center;">Instructions</h4>
                <ol style="padding-left: 18px; margin-bottom: 0;">
                  <li style="margin-bottom: 8px;">Connect To Laptop Hotspot<br>
                    <span style="margin-left: 8px; color: #555; font-size: 14px;">Name: <b>Attendance CS</b><br>Password: <b>12345678</b></span>
                  </li>
                  <li style="margin-bottom: 8px;">Scan New QR</li>
                  <li style="margin-bottom: 8px;">Input Student ID <span style="color: #555; font-size: 14px;">(With Dash)</span></li>
                  <li style="margin-bottom: 0; color: #b22222; font-size: 14px;">Only Works with Built-In Scanners</li>
                </ol>
              </div>
            </div>
            <!-- Bottom Row: QR Code Generator -->
            <div class="dashboard-bottom-row" style="display: flex; justify-content: center; align-items: center; width: 100%; min-height: 320px; max-width: 700px; margin: 0 auto; gap: 48px;">
              <!-- QR Code Section -->
              <div class="qr-section" style="display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 16px; width: 100%;">
                <div style="flex: 0 0 auto; text-align: center;">
                  <img id="qr-img" class="qr-code" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OTk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIFFSIENvZGU8L3RleHQ+PC9zdmc+" alt="QR Code" />
                  <button id="generate-btn" class="btn btn-primary" style="width: 100%; margin-top: 10px;">Generate New QR Code</button>
                  <div id="qr-status" style="margin: 10px 0; font-size: 14px; color: #666;">Click to generate a QR code</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Data Tables -->
        <!-- Successful Check-ins -->
        <div class="table-section">
          <div class="table-header">
            <div style="display: flex; align-items: center; gap: 15px;">
              <h3>Successful Check-ins</h3>
              <button id="refresh-data" class="btn btn-refresh">Refresh</button>
              <button id="clear-all-data" class="btn btn-danger" style="margin-left: 10px;">Clear All Data</button>
            </div>
          </div>
          <table>
            <thead>
              <tr>
                <th style="width: 15%;">Time</th>
                <th style="width: 20%;">Name</th>
                <th style="width: 15%;">Course</th>
                <th style="width: 10%;">Year</th>
                <th style="width: 15%;">Device</th>
                <th style="width: 25%;">Token</th>
              </tr>
            </thead>
            <tbody id="attendances">
              <tr>
                <td colspan="6" style="text-align: center; padding: 20px; color: #666;">Loading attendance data...</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Failed Check-ins -->
        <div class="table-section">
          <div class="table-header">
            <h3>Failed Check-ins</h3>
          </div>
          <table>
            <thead>
              <tr>
                <th style="width: 18%;">Time</th>
                <th style="width: 22%;">Name</th>
                <th style="width: 25%;">Reason</th>
                <th style="width: 18%;">Token</th>
                <th style="width: 17%;">Device</th>
              </tr>
            </thead>
            <tbody id="denied-attendances">
              <tr>
                <td colspan="5" style="text-align: center; padding: 20px; color: #666;">No failed attempts</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Device Tracking -->
        <div class="table-section">
          <div class="table-header">
            <h3>Device Tracking</h3>
          </div>
          <table>
            <thead>
              <tr>
                <th style="width: 25%;">Device ID</th>
                <th style="width: 20%;">First Seen</th>
                <th style="width: 20%;">Last Seen</th>
                <th style="width: 15%;">Usage Count</th>
                <th style="width: 20%;">Device Info</th>
              </tr>
            </thead>
            <tbody id="device-fingerprints">
              <tr>
                <td colspan="5" style="text-align: center; padding: 20px; color: #666;">No device data available</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <!-- Custom Modal -->
  <div id="customModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div id="modalTitle" class="modal-title">Confirmation</div>
        <div id="modalMessage" class="modal-message">Are you sure?</div>
      </div>
      <div class="modal-actions">
        <button id="modalCancel" class="modal-btn modal-btn-secondary">Cancel</button>
        <button id="modalConfirm" class="modal-btn modal-btn-primary">Confirm</button>
      </div>
    </div>
  </div>


</body>
</html>
